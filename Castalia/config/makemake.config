#
# Makefile to create all other makefiles for the project.
#
# CAREFUL: This file has to remain portable across Unix make and Windows nmake!
#

# The vars ROOT, MAKEMAKE and EXT have to be specified externally, on the 'make' command line.
#ROOT=/home/User/dir_to_Castalia
#MAKEMAKE=opp_nmakemake
#EXT=.vc

CONFIGDIR = $(ROOT)/config
SRCDIR = $(ROOT)/src


#comment this out if you want the simulator to be built with TKENV
UI_CMDENV = -u Cmdenv

# for compiled-in NED files, remove -N from OPTS, and switch to the longer version of ALL_MODEL_OPTS below
# with omnetpp-3.2 or newer, if you want to build windows dlls, add this to OPTS below: -PINET_API
OPTS=-f -N -b $(ROOT) -c $(CONFIGDIR)/Castalia.config$(EXT) -I. $(UI_CMDENV)


ALL_WSN_INCLUDES = -I$(SRCDIR) -I$(SRCDIR)/Node -I$(SRCDIR)/Node/Application -I$(SRCDIR)/Node/Application/ValuePropagationApp -I$(SRCDIR)/Node/Application/IDEA -I$(SRCDIR)/Node/Application/connectivityMap -I$(SRCDIR)/Node/Application/multipathAggregation -I$(SRCDIR)/Node/Communication -I$(SRCDIR)/Node/Communication/MAC -I$(SRCDIR)/Node/Communication/MAC/TunableMac -I$(SRCDIR)/Node/Communication/Radio -I$(SRCDIR)/Node/Resource_Manager -I$(SRCDIR)/Node/Sensor_Device_Manager -I$(SRCDIR)/Physical_Process -I$(SRCDIR)/Wireless_Channel 


# -I$(SRCDIR)/Node/Application/TrustApp/ClusterHeadApplication -I$(SRCDIR)/Node/Application/TrustApp/NodeApplication -I$(SRCDIR)/Node/Application/TrustApp/SinkApplication -I$(SRCDIR)/Node/Application/TrustApp/MaliciousApplication

ALL_MODEL_OPTS=$(OPTS) -n


#
# Example simulations don't contain C++ code, only NED, ini and other config
# files, so they don't need Makefiles. They all invoke the bin/INET executable.
#

all: WSNetwork

WSNetwork:
	$(MAKEMAKE) $(OPTS) -n -r -i $(CONFIGDIR)/makefrag -X config -X Simulations

	cd bin && $(MAKEMAKE) $(OPTS) -w -o CastaliaBin $(ALL_WSN_INCLUDES)

	# SensorNetwork Compound Module
	cd $(SRCDIR) && $(MAKEMAKE) $(OPTS) -n -r

	# Node Compound Module
	cd $(SRCDIR)/Node && $(MAKEMAKE) $(OPTS) -n -r
	cd $(SRCDIR)/Node/Application && $(MAKEMAKE) $(OPTS) -n -r -X templateApplication
	cd $(SRCDIR)/Node/Application/ValuePropagationApp && $(MAKEMAKE) $(OPTS) -n -r  -I$(SRCDIR)/Node/Application -I$(SRCDIR)/Node/Sensor_Device_Manager -I$(SRCDIR)/Node/Resource_Manager  -I$(SRCDIR)/Node/Communication/MAC
	#cd $(SRCDIR)/Node/Application/templateApplication && $(MAKEMAKE) $(OPTS) -n -r  -I$(SRCDIR)/Node/Application -I$(SRCDIR)/Node/Sensor_Device_Manager -I$(SRCDIR)/Node/Resource_Manager  -I$(SRCDIR)/Node/Communication/MAC
	cd $(SRCDIR)/Node/Application/IDEA && $(MAKEMAKE) $(OPTS) -n -r  -I$(SRCDIR)/Node/Application -I$(SRCDIR)/Node/Sensor_Device_Manager -I$(SRCDIR)/Node/Resource_Manager  -I$(SRCDIR)/Node/Communication/MAC
	cd $(SRCDIR)/Node/Application/connectivityMap && $(MAKEMAKE) $(OPTS) -n -r  -I$(SRCDIR)/Node/Application -I$(SRCDIR)/Node/Sensor_Device_Manager -I$(SRCDIR)/Node/Resource_Manager  -I$(SRCDIR)/Node/Communication/MAC
	cd $(SRCDIR)/Node/Application/multipathAggregation && $(MAKEMAKE) $(OPTS) -n -r  -I$(SRCDIR)/Node/Application -I$(SRCDIR)/Node/Sensor_Device_Manager -I$(SRCDIR)/Node/Resource_Manager  -I$(SRCDIR)/Node/Communication/MAC
#	cd $(SRCDIR)/Node/Application/TrustApp && $(MAKEMAKE) $(OPTS) -n -r
#	cd $(SRCDIR)/Node/Application/TrustApp/ClusterHeadApplication && $(MAKEMAKE) $(OPTS) -n -r  -I$(SRCDIR)/Node/Application -I$(SRCDIR)/Node/Sensor_Device_Manager -I$(SRCDIR)/Node/Resource_Manager  -I$(SRCDIR)/Node/Communication/MAC
#	cd $(SRCDIR)/Node/Application/TrustApp/NodeApplication && $(MAKEMAKE) $(OPTS) -n -r  -I$(SRCDIR)/Node/Application -I$(SRCDIR)/Node/Sensor_Device_Manager -I$(SRCDIR)/Node/Resource_Manager  -I$(SRCDIR)/Node/Communication/MAC
#	cd $(SRCDIR)/Node/Application/TrustApp/MaliciousApplication && $(MAKEMAKE) $(OPTS) -n -r  -I$(SRCDIR)/Node/Application -I$(SRCDIR)/Node/Sensor_Device_Manager -I$(SRCDIR)/Node/Resource_Manager  -I$(SRCDIR)/Node/Communication/MAC
#	cd $(SRCDIR)/Node/Application/TrustApp/SinkApplication && $(MAKEMAKE) $(OPTS) -n -r  -I$(SRCDIR)/Node/Application -I$(SRCDIR)/Node/Sensor_Device_Manager -I$(SRCDIR)/Node/Resource_Manager  -I$(SRCDIR)/Node/Communication/MAC
	cd $(SRCDIR)/Node/Communication && $(MAKEMAKE) $(OPTS) -n -r -I$(SRCDIR)/Node/Application -I$(SRCDIR)/Node/Communication/MAC -I$(SRCDIR)/Node/Communication/Radio
	cd $(SRCDIR)/Node/Communication/MAC && $(MAKEMAKE) $(OPTS) -n -r
	cd $(SRCDIR)/Node/Communication/MAC/TunableMac && $(MAKEMAKE) $(OPTS) -n -r -I$(SRCDIR)/Node/Communication/MAC -I$(SRCDIR)/Node/Communication/Radio -I$(SRCDIR)/Node/Application  -I$(SRCDIR)/Wireless_Channel -I$(SRCDIR)/Node/Resource_Manager
	cd $(SRCDIR)/Node/Communication/Radio && $(MAKEMAKE) $(OPTS) -n -r -I$(SRCDIR)/Node/Communication/MAC -I$(SRCDIR)/Node/Application -I$(SRCDIR)/Node/Resource_Manager -I$(SRCDIR)/Wireless_Channel
	cd $(SRCDIR)/Node/Resource_Manager && $(MAKEMAKE) $(OPTS) -n -r
	cd $(SRCDIR)/Node/Sensor_Device_Manager && $(MAKEMAKE) $(OPTS) -n -r -I$(SRCDIR)/Physical_Process -I$(SRCDIR)/Node/Resource_Manager -I$(SRCDIR)/Node/Application
	
	# PhysicalProcess Simple Module
	cd $(SRCDIR)/Physical_Process && $(MAKEMAKE) $(OPTS) -n -r
	
	# Wireless_Channel Simple Module
	cd $(SRCDIR)/Wireless_Channel && $(MAKEMAKE) $(OPTS) -n -r
